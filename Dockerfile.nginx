FROM ghcr.io/aasaam/nginx-extra:latest

ENV ASM_NGX_EXTRA_WORKER_PROCESSES="auto" \
  ASM_NGX_EXTRA_WORKER_RLIMIT_NOFILE="80000" \
  ASM_NGX_EXTRA_ERROR_LOG_LEVEL="warn" \
  ASM_NGX_EXTRA_WORKER_CONNECTIONS="2048" \
  ASM_NGX_EXTRA_CLIENT_BODY_TIMEOUT="4s" \
  ASM_NGX_EXTRA_CLIENT_HEADER_TIMEOUT="4s" \
  ASM_NGX_EXTRA_KEEPALIVE_REQUESTS="20480" \
  ASM_NGX_EXTRA_KEEPALIVE_TIMEOUT="30" \
  ASM_NGX_EXTRA_SEND_TIMEOUT="2" \
  ASM_NGX_EXTRA_CLIENT_BODY_BUFFER_SIZE="256k" \
  ASM_NGX_EXTRA_CLIENT_HEADER_BUFFER_SIZE="2k" \
  ASM_NGX_EXTRA_LARGE_CLIENT_HEADER_BUFFERS="4 1k" \
  ASM_NGX_EXTRA_VARIABLES_HASH_MAX_SIZE="4096" \
  ASM_NGX_EXTRA_PROXY_CACHE_FAST_SIZE="128m" \
  ASM_NGX_EXTRA_ACCESS_LOG_COMMENT="#" \
  ASM_NGX_EXTRA_SSL_PROFILE="legacy" \
  ASM_NGX_EXTRA_UPSTREAM="http://analytics-collector:4000"

ADD nginx/nginx.conf /template/nginx.conf
ADD nginx/grafana.htpasswd /grafana.htpasswd
ADD nginx/cert /cert
